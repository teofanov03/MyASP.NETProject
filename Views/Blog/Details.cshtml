@model TodoBlog.Models.Post
@{
    ViewData["Title"] = Model.Title;
}

<h2>@Model.Title</h2>

@if (User.Identity.IsAuthenticated && Model.UserId == User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value)
{
    <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-sm btn-secondary">Edit Post</a>
    <form asp-action="Delete" asp-route-id="@Model.Id" method="post" class="mt-2">
        <button type="submit" class="btn btn-danger">Delete Post</button>
    </form>
}

<small class="text-muted">@Model.CreatedAt.ToLocalTime()</small>
<p class="mt-3">@Model.Content</p>

<hr />
<h4>Comments (@Model.Comments.Count)</h4>

@if (!Model.Comments.Any())
{
    <p>No comments yet.</p>
}
else
{
    <ul class="list-group mb-3">
        @foreach (var c in Model.Comments.OrderByDescending(c => c.CreatedAt))
        {
            <li class="list-group-item">
                <strong>@c.AuthorUserName</strong>
                <small class="text-muted"> — @c.CreatedAt.ToLocalTime()</small>
                <div>@c.Body</div>

                @if (User.Identity.IsAuthenticated && c.UserId == User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value)
                {
                    <div class="mt-2">
                        <a asp-action="EditComment" asp-route-id="@c.Id" class="btn btn-sm btn-secondary">Edit</a>
                        <form asp-action="DeleteComment" asp-route-id="@c.Id" method="post" class="d-inline">
                            <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                        </form>
                    </div>
                }
            </li>
        }
    </ul>
}

<h5>Add a comment</h5>
<form asp-action="AddComment" method="post">
    <input type="hidden" name="postId" value="@Model.Id" />
    <div class="mb-3">
        <label class="form-label">Comment</label>
        <textarea name="body" class="form-control" rows="4"></textarea>
    </div>
    <button class="btn btn-primary" type="submit">Send</button>
</form>
